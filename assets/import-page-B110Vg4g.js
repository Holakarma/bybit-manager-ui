import{g as k,a as N,s as $,r as f,u as M,j as t,c as H,b as F,A as U,E as L,d as W,e as G,f as T,O as Y,I as q,h as E,B as w,S as g,T as _,i as V,P as z,k as Q,M as J,l as K}from"./index-qW0Bl-gJ.js";import{i as S,T as I,a as X,b as Z,c as ee}from"./isEmptyValues-yKJogLeQ.js";import{T as te,u as se,a as C,b as x}from"./index-BJ9Ofrya.js";import{u as v,t as ne,w as oe,r as ae}from"./xlsx-DKYnQKbW.js";function re(s){return N("MuiTableHead",s)}k("MuiTableHead",["root"]);const ie=s=>{const{classes:e}=s;return F({root:["root"]},re,e)},ce=$("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(s,e)=>e.root})({display:"table-header-group"}),de={variant:"head"},B="thead",le=f.forwardRef(function(e,n){const i=M({props:e,name:"MuiTableHead"}),{className:o,component:c=B,...a}=i,r={...i,component:c},l=ie(r);return t.jsx(te.Provider,{value:de,children:t.jsx(ce,{as:c,className:H(l.root,o),ref:n,role:c===B?null:"rowgroup",ownerState:r,...a})})}),pe={ACCOUNT_EXISTS:"Account already exists.",UNKNOWN_ERROR:"UNKNOWN_ERROR",BAD_REQUEST:"BAD_REQUEST",INTEGRITY_ERROR:"INTEGRITY_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",BYBIT_JSON_ERROR:"BYBIT_JSON_ERROR",BYBIT_HTML_ERROR:"BYBIT_HTML_ERROR",BYBIT_COMPONENT_ERROR:"BYBIT_COMPONENT_ERROR",INTERNAL_SERVER_ERROR:"INTERNAL_SERVER_ERROR"},ue=s=>{const e=new U,n=L.import_account;return e.Post(n,s)};class he{constructor(e){this.name=e.name,this.note=e.note,this.group_name=e.group,this.password=e.bybit_password,this.totp_secret=e.bybit_totp,this.inviter_ref_code=e.ref_code,this.web3_mnemonic_phrase=e.web3_mnemonic_phrase,this.proxy=e.bybit_proxy,this.email={address:e.bybit_email,imap_address:e.imap_address,imap_password:e.imap_password,proxy:e.email_proxy},this.cookies=JSON.parse(e.cookies||"[]")}get bybit_email(){return this.email.address}}const me=({form:s,onError:e,onSuccess:n})=>{const i={};for(const[a,r]of s.entries()){const l=a.match(/^accounts\[(\d+-\d+)\]\[(\w+)\]$/);if(l){const[,d,u]=l;i[d]=i[d]||{},i[d][u]=r||void 0}}const o=Object.values(i).filter(a=>!S(a)),c=(a=0,r=[])=>new Promise(l=>{if(a>=o.length)return l(r);const d=new he(o[a]);return ue(d).then(u=>{n&&n(o[a],u),r.push(u)}).catch(u=>{e&&e(d,u),r.push({success:!1,account:d,error:u})}).finally(()=>{l(c(a+1,r))})});return c()},xe=()=>se({mutationFn:({form:s,onSuccess:e,onError:n})=>me({form:s,onSuccess:e,onError:n})}),O={note:void 0,group:void 0,name:void 0,ref_code:void 0,bybit_email:void 0,imap_address:void 0,imap_password:void 0,web3_mnemonic_phrase:void 0,bybit_password:void 0,bybit_totp:void 0,bybit_proxy:void 0,email_proxy:void 0,country_code:void 0,cookies:void 0},R=()=>({...O,id:C()}),A=s=>({...O,...s,id:C()}),ye=W(s=>({accounts:[R()],setAccounts:e=>s({accounts:[...e.map(n=>A(n)),R()]}),addAccount:e=>s(n=>({accounts:[...n.accounts.slice(0,-1),A(e),R()]})),editAccount:(e,n)=>s(i=>{const o=[...i.accounts],c=S(n);return c&&e<o.length-1?o.splice(e,1):(o[e]=n,e===o.length-1&&!c&&o.push({...R()})),{accounts:o}}),deleteAccount:e=>s(n=>({accounts:[...n.accounts].filter(i=>i.id!==e)}))})),j=G(ye),be=()=>t.jsx(le,{sx:{"& th":{borderWidth:"2px",borderColor:"secondary.main"}},children:t.jsxs(I,{children:[t.jsx(x,{sx:{padding:"4px"},children:"Note"}),t.jsx(x,{sx:{padding:"4px"},children:"Group name*"}),t.jsx(x,{sx:{padding:"4px"},children:"Name"}),t.jsx(x,{sx:{padding:"4px"},children:"Inviter ref code"}),t.jsx(x,{sx:{padding:"4px"},children:"Bybit address*"}),t.jsx(x,{sx:{padding:"4px"},children:"IMAP address"}),t.jsx(x,{sx:{padding:"4px"},children:"IMAP password"}),t.jsx(x,{sx:{padding:"4px"},children:"Bybit password"}),t.jsx(x,{sx:{padding:"4px"},children:"TOTP Secret"}),t.jsx(x,{sx:{padding:"4px"},children:"WEB3 Mnemonic Phase"}),t.jsx(x,{sx:{padding:"4px"},children:"Bybit proxy"}),t.jsx(x,{sx:{padding:"4px"},children:"Email proxy"}),t.jsx(x,{sx:{padding:"4px"},children:"Country code"}),t.jsx(x,{sx:{padding:"4px"},children:"Cookies"})]})}),fe=({inputProps:s,...e})=>{const n=T(),i=s.type==="hidden";return t.jsx(Y,{size:"small",inputProps:{style:{fontFamily:n.typography.Body.fontFamily,fontSize:n.typography.Body.fontSize,fontWeight:n.typography.Body.fontWeight,letterSpacing:n.typography.Body.letterSpacing,lineHeight:n.typography.Body.lineHeight},...s},sx:{...i&&{display:"none"},"&::placeholder":{color:n.palette.text.secondary,opacity:1},borderRadius:"8px",borderColor:n.palette.secondary.main},fullWidth:!0,...e})},m=({inputProps:s,...e})=>t.jsx(x,{component:"th",scope:"row",sx:(s==null?void 0:s.type)!=="hidden"?{padding:"12px 4px 0"}:{padding:0},...e,children:t.jsx(fe,{inputProps:s})}),ge=({account:s,onEdit:e,sx:n,...i})=>{const[o,c]=f.useState(s),a=d=>{const{name:u,value:y}=d.target,[,,b]=u.match(/^accounts\[(\d+-\d+)\]\[(\w+)\]$/);c(p=>({...p,[b]:y}))},r=()=>{e(o)},l=f.useMemo(()=>!S(s),[s]);return t.jsxs(I,{...i,sx:{"& td, & th":{border:0},...n},children:[t.jsx(m,{inputProps:{name:`accounts[${s.id}][note]`,value:o.note,placeholder:"Note",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{required:l,name:`accounts[${s.id}][group]`,value:o.group,placeholder:"Group name",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{name:`accounts[${s.id}][name]`,value:o.name,placeholder:"Account name",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{name:`accounts[${s.id}][ref_code]`,value:o.ref_code,placeholder:"Inviter's code",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{required:l,name:`accounts[${s.id}][bybit_email]`,type:"email",value:o.bybit_email,placeholder:"example@gmail.com",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{name:`accounts[${s.id}][imap_address]`,value:o.imap_address,type:"email",placeholder:"IMAP address",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{name:`accounts[${s.id}][imap_password]`,value:o.imap_password,placeholder:"IMAP password",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{name:`accounts[${s.id}][bybit_password]`,value:o.bybit_password,placeholder:"Bybit password",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{name:`accounts[${s.id}][bybit_totp]`,value:o.bybit_totp,placeholder:"TOTP secret",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{name:`accounts[${s.id}][web3_mnemonic_phrase]`,value:o.web3_mnemonic_phrase,placeholder:"W3 Mnemonic Phase",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{name:`accounts[${s.id}][bybit_proxy]`,value:o.bybit_proxy,placeholder:"Bybit proxy",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{name:`accounts[${s.id}][email_proxy]`,value:o.email_proxy,placeholder:"Email proxy",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{name:`accounts[${s.id}][country_code]`,value:o.country_code,placeholder:"Country code",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{name:`accounts[${s.id}][cookies]`,value:o.cookies,placeholder:"Cookies",onChange:a,onBlur:r}}),t.jsx(m,{inputProps:{name:`accounts[${s.id}][id]`,value:o.id,type:"hidden"}})]})},_e=s=>["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(s.type),je=({...s})=>t.jsx(q,{...s,sx:{clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}}),we=()=>{const s=v.aoa_to_sheet(ne),e=v.book_new(),n=new Date,i=String(n.getDate()).padStart(2,"0"),o=String(n.getMonth()+1).padStart(2,"0"),c=n.getFullYear(),a=String(n.getHours()).padStart(2,"0"),r=String(n.getMinutes()).padStart(2,"0"),l=String(n.getSeconds()).padStart(2,"0"),d=`${i}.${o}.${c} ${a}h${r}m${l}s`;v.book_append_sheet(e,s,d),oe(e,"template.xlsx")},Re=s=>new Promise(e=>{const n=new FileReader;n.onload=i=>{const o=new Uint8Array(i.target.result),c=ae(o,{type:"array"});var a={};for(var r in c.Sheets){const l=c.Sheets[r];let d=v.sheet_to_json(l,{header:1});d=d.filter(u=>u.some(y=>y!=null&&y!=="")),a[r]=d}e(a)},n.readAsArrayBuffer(s)});class ve{constructor(e){this.note=e["[bybit] Note"],this.group=e["[bybit] Group"],this.name=e["[bybit] Name"],this.ref_code=e["[bybit] Inviter ref. code"],this.bybit_email=e["[email] Address"],this.imap_address=e["[email] IMAP Address"],this.imap_password=e["[email] IMAP password"],this.bybit_password=e["[bybit] Password"],this.bybit_totp=e["[bybit] TOTP secret"],this.web3_mnemonic_phrase=e["[bybit] Mnemonic phrase"],this.bybit_proxy=e["[bybit] Proxy"],this.email_proxy=e["[email] Proxy"],this.country_code=e["[bybit] Country code"],this.cookies=e["[bybit] Cookies"]}}const Ae=({file:s})=>{const{enqueueSnackbar:e}=E(),n=j.use.addAccount(),i=j.use.accounts(),o=()=>{Re(s).then(a)},c=r=>{e(r,{variant:"warning"})},a=r=>{for(var[l,d]of Object.entries(r)){if(d.length<2){c(`sheet ${l} is empty`);continue}const u=d[0];console.log(u),d.slice(1).forEach(y=>{const b=u.reduce((h,P,D)=>(h[P]=y[D]||void 0,h),{});if(i.find(h=>h.bybit_email===b["[email] Address"])){c(`Email ${b["[email] Address"]} is already in the table`);return}const p=A(new ve(b));n(p)})}};return t.jsx(w,{sx:{padding:"1px !important"},onClick:o,children:"Upload"})},Te=({...s})=>{const{palette:e}=T(),[n,i]=f.useState(!1),[o,c]=f.useState(null),{enqueueSnackbar:a}=E(),r=p=>{p.preventDefault(),i(!0)},l=p=>{p.preventDefault(),i(!1)},d=p=>{p.preventDefault()},u=p=>{p.preventDefault(),i(!1);const h=Array.from(p.dataTransfer.files);b(h)},y=p=>{const h=Array.from(p.target.files);b(h)},b=p=>{const h=p.filter(_e);h.length>0?c(h[0]):a("Only .xlsx and .xls files are supported",{variant:"error"})};return t.jsxs(g,{...s,alignItems:"end",gap:1,children:[t.jsxs(w,{component:"label",variant:"unstyled",sx:{width:"100%"},disableRipple:!!o,children:[t.jsx(je,{accept:".xlsx .xls",type:"file",onChange:y}),t.jsx(g,{width:"100%",alignItems:"center",justifyContent:"center",p:5,border:`4px dashed ${n?e.primary.main:e.secondary.main}`,borderRadius:3,onDragEnter:r,onDragLeave:l,onDragOver:d,onDrop:u,sx:{cursor:"pointer",transition:"border-color 0.3s ease"},children:t.jsx(g,{alignItems:"center",children:o?t.jsxs(g,{children:[t.jsx(_,{variant:"BodyM",children:o.name}),t.jsx(Ae,{file:o})]}):t.jsxs(t.Fragment,{children:[t.jsx(_,{variant:"BodyM",children:"Drop the .xlsx file here or"}),t.jsx(_,{variant:"BodyM",sx:{textDecoration:"underline"},children:"Pick one"})]})})})]}),t.jsx(w,{variant:"unstyled",color:e.textPrimary.default,sx:{"&:hover":{opacity:.8}},onClick:we,children:t.jsx(_,{variant:"Caption",sx:{textDecoration:"underline"},children:"Download the template file"})})]})},Ee=({...s})=>{const e=j.use.accounts(),n=j.use.editAccount(),i=T();return t.jsx(g,{justifyContent:"space-between",alignItems:"end",overflow:"auto",...s,children:t.jsx(X,{sx:{flexGrow:1,paddingBlock:1,scrollbarWidth:"thin",scrollbarColor:`${i.palette.textSecondary.default} transparent`},children:t.jsxs(Z,{sx:{minWidth:2200},children:[t.jsx(be,{}),t.jsx(ee,{children:e.map((o,c)=>t.jsx(ge,{account:o,onEdit:a=>n(c,a)},o.id))})]})})})},Se=({buttonProps:s,...e})=>j.use.accounts().slice(1).length?t.jsx(V,{pt:2,textAlign:"end",...e,children:t.jsx(w,{variant:"contained",color:"primary",type:"submit",loadingIndicator:"Importing...",...s,children:"Start import"})}):null,Be=({onSuccess:s,onError:e})=>{const{mutate:n,isPending:i}=xe();return t.jsx(z,{sx:{flexGrow:1,overflow:"auto"},component:"form",onSubmit:o=>{o.preventDefault(),n({form:new FormData(o.target),onError:e,onSuccess:s})},children:t.jsxs(g,{p:3,height:"100%",children:[t.jsx(Te,{}),t.jsx(Ee,{sx:{marginTop:2,flexGrow:1,overflow:"auto"}}),t.jsx(Se,{buttonProps:{loading:i}})]})})},De=()=>{const s=j.use.deleteAccount(),{enqueueSnackbar:e}=E(),[n,i]=f.useState(!1),o=()=>i(!0),c=()=>i(!1),[a,r]=f.useState(null),[l,d]=f.useState(null),u=Q(),y=(p,h)=>{e(`Import ${p.bybit_email} failed`,{variant:"error",action:()=>t.jsx(w,{onClick:()=>{o(),r(p),d(h)},color:"inherit",size:"small",children:"DETAILS"})})},b=(p,h)=>{e(`${h.email.address} successfully imported`,{variant:"success"}),s(p.id),u.invalidateQueries({key:["accounts"]})};return t.jsxs(g,{gap:4,flexGrow:1,maxHeight:"100%",children:[t.jsx(_,{variant:"H3",children:"Import accounts"}),t.jsx(Be,{onError:y,onSuccess:b}),t.jsx(J,{open:n,onClose:c,children:t.jsxs(K,{children:[t.jsxs(_,{variant:"H6",children:["Error while import account"," ",(a==null?void 0:a.email.address)||""]}),t.jsx(_,{sx:{mt:2},children:l?pe[l.data.error]||l.data.detail:"Cannot reach the server. It looks like you forgot to turn on the API server."})]})})]})};export{De as default};
