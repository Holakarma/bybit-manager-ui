import{g as X,G as K,j as e,aK as me,aL as L,r as b,aM as N,am as H,Y as xe,ac as je,ad as q,aN as A,e as I,T as P,u as fe,S as C,B as ye,aJ as re,aj as be,an as ve,L as we,al as G,P as te}from"./index-q-_SOf4_.js";import{l as Y,m as T,j as Ce,b as B,h as ke,i as ge,k as Te,I as Se,R as qe,d as se,e as ae,f as Pe,g as J,u as Re}from"./selectedRequest-KtWGC-IQ.js";import{a as _,u as oe,C as Ee,c as ie,d as ce,L as de,b as le,A as Oe,e as Ae}from"./index.esm-CKdOQT_C.js";import{i as Ie}from"./isEmptyValues-BYo5e0_1.js";const He=()=>{const s=X();return _({mutationFn:async t=>await Y.addCustomRequest(t),mutationKey:["add-custom-request"],onSuccess:()=>{s.invalidateQueries({queryKey:["custom-requests"]})}})},De=()=>{const s=X();return _({mutationFn:async t=>await Y.deleteCustomRequest(t),mutationKey:["delete-custom-request"],onSuccess:()=>{s.invalidateQueries({queryKey:["custom-requests"]})}})},Be=()=>{const s=X();return _({mutationFn:async({id:t,newCustomRequestData:a})=>await Y.updateCustomRequest(t,a),mutationKey:["update-custom-request"],onSuccess:()=>{s.invalidateQueries({queryKey:["custom-requests"]})}})},$=s=>s.reduce((t,{key:a,value:r,active:n,id:o})=>(a.trim()&&(t[a]={value:r,active:n,id:o}),t),{}),z=s=>Object.entries(s).map(([t,a])=>({key:t,...a}));class Je{constructor(t){this.method=t.method,this.title=t.title,this.path=t.path,this.params=$(t.params),this.headers=$(t.headers),this.cookies=$(t.cookies),this.json=t.json?JSON.parse(t.json):{},this.data=t.data,this.bodyType=t.bodyType,this.id=t.id}}const Me=K(e.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy"),Fe=(s,t,a)=>{let r="";for(;s.length>0;){const n=s.match(t);n?(r+=s.slice(0,n.index),r+=a(n),s=s.slice(n.index+n[0].length)):(r+=s,s="")}return r},Le=(s="")=>{const t=[];let a="";return Fe(s,/\s*(?:([^\s\\\'\"]+)|'((?:[^\'\\]|\\.)*)'|"((?:[^\"\\]|\\.)*)"|(\\.?)|(\S))(\s|$)?/,r=>{const[n,o,c,i,h,d,l]=r;if(d!=null)throw new Error("Unmatched quote");a+=o||(c||i||h).replace(/\\(?=.)/,""),l!=null&&(t.push(a),a="")}),a&&t.push(a),t},Ne=s=>{if(s.indexOf("curl ")==0){var t=Ge(Le(s)),a={method:"GET",header:{}},r="";return t.forEach(function(n){switch(!0){case ze(n):a.url=n;break;case(n=="-A"||n=="--user-agent"):r="user-agent";break;case(n=="-H"||n=="--header"):r="header";break;case(n=="-d"||n=="--data"||n=="--data-ascii"||n=="--data-raw"):r="data";break;case(n=="-u"||n=="--user"):r="user";break;case(n=="-I"||n=="--head"):a.method="HEAD";break;case(n=="-X"||n=="--request"):r="method";break;case(n=="-b"||n=="--cookie"):r="cookie";break;case n=="--compressed":a.header["Accept-Encoding"]=a.header["Accept-Encoding"]||"deflate, gzip";break;case(n=="-F"||n=="--form"):r="form-data";break;case!!n:switch(r){case"form-data":a.data=a.data||[],a.data.push(n),r="";break;case"header":var o=$e(n);a.header[o[0]]=o[1],r="";break;case"user-agent":a.header["User-Agent"]=n,r="";break;case"data":(a.method=="GET"||a.method=="HEAD")&&(a.method="POST"),a.header["Content-Type"]=a.header["Content-Type"]||"application/x-www-form-urlencoded",a.body=a.body?a.body+"&"+n:n,r="";break;case"user":a.header.Authorization="Basic "+btoa(n),r="";break;case"method":a.method=n,r="";break;case"cookie":a.header["Set-Cookie"]=n,r="";break}break}}),a}};function Ge(s){return s.reduce(function(t,a){return a.indexOf("-X")==0?(t.push("-X"),t.push(a.slice(2))):t.push(a),t},[])}function $e(s){return s.split(/: (.+)/)}function ze(s){return/^https?:\/\//.test(s)}const Ue="https://api2.bybit.com",We=s=>{const{method:t="GET",path:a="",params:r={},headers:n={},cookies:o={},json:c={},data:i="",bodyType:h="JSON"}=s,d=`${Ue}/${a}`,l=new URL(d);Object.entries(r).filter(([x,p])=>p.active).forEach(([x,p])=>{l.searchParams.append(x,p.value)});let m=["curl"];m.push(`-X ${t}`),Object.entries(n).filter(([x,p])=>p.active).forEach(([x,p])=>{m.push(`-H "${x}: ${p.value}"`)});const w=Object.entries(o).filter(([x,p])=>p.active).map(([x,p])=>`${x}=${p.value}`).join("; ");if(w&&m.push(`-b "${w}"`),t!=="GET"&&t!=="HEAD")if(h==="JSON"&&Object.keys(c).length>0){const x=JSON.stringify(c);m.push(`-d '${x}'`),m.push('-H "Content-Type: application/json"')}else h==="x-www-form-urlencoded"&&i&&(m.push(`-d '${i}'`),m.push('-H "Content-Type: application/x-www-form-urlencoded"'));return m.push(`"${l.toString()}"`),m.join(" ")},W=s=>{try{const t=typeof s=="string"?JSON.parse(s):s;return JSON.stringify(t,null,2)}catch(t){return console.error("Invalid JSON:",t),""}},Xe=()=>{const s=He(),t=Be(),a=T.use.request(),r=T.use.setRequest();return{onSubmit:o=>{const c=new Je({...o,params:o.params.filter(i=>i.key&&i.value),headers:o.headers.filter(i=>i.key&&i.value),cookies:o.cookies.filter(i=>i.key&&i.value)});a?t.mutate({id:c.id,newCustomRequestData:c}):s.mutate(c),r(c)},isLoading:s.isPending||t.isPending}},Ke=s=>{const t={};if(!s)return t;const a=s.split(";");for(const r of a){const[n,o]=r.trim().split("=");n&&(t[n]=o||"")}return t},y=()=>({key:"",value:"",active:!0,id:oe()}),Ye=s=>{const t=me({defaultValues:s,mode:"onChange"}),{fields:a,append:r,remove:n,replace:o}=L({control:t.control,name:"params"}),{fields:c,append:i,remove:h,replace:d}=L({control:t.control,name:"headers"}),{fields:l,append:m,remove:w,replace:x}=L({control:t.control,name:"cookies"}),p=b.useMemo(()=>({append:{params:r,headers:i,cookies:m},remove:{params:n,headers:h,cookies:w},replace:{params:o,headers:d,cookies:x}}),[r,i,n,h,o,d,m,w,x]),f=N({control:t.control,name:"params"}),v=N({control:t.control,name:"headers"}),R=N({control:t.control,name:"cookies"}),k=b.useMemo(()=>({params:f||a,headers:v||c,cookies:R||l}),[f,v,R,a,c,l]),M=b.useCallback((E,O,S)=>{const D=E===k[S].length-1,{active:V,...F}=O,g=Ie(F);if(D&&!g&&p.append[S](y()),!D&&g){p.remove[S](E);return}t.setValue(`${S}.${E}`,O,{shouldDirty:!0}),t.trigger(`${S}.${E}`)},[k,p,t]);return{...t,fieldArrays:k,fieldsController:p,handleArrayFieldsChange:M}};function _e({e:s,setValue:t,trigger:a,fieldsController:r,resetField:n}){s.preventDefault();const o=s.clipboardData.getData("text").trim();try{const c=new URL(o);t("path",c.pathname.substring(1)),a("path");const i={};for(const[d,l]of c.searchParams.entries())i[d]=l;const h=Object.entries(i).map(([d,l])=>({key:d,value:l}));r.remove.params(),h.length>0&&r.append.params([...h]),r.append.params([y()])}catch{try{const i=Ne(o);t("method",i.method||"GET"),a("method");const h=new URL(i.url);t("path",h.pathname.substring(1)),a("path");const d={};for(const[f,v]of h.searchParams.entries())d[f]=v;const l=Object.entries(d).map(([f,v])=>({...y(),key:f,value:v}));r.remove.params(),r.append.params([...l,y()]);const{"Set-Cookie":m,...w}=i.header;let x=[];if(m){const f=Ke(m);x=Object.entries(f).map(([v,R])=>({...y(),key:v,value:R}))}r.remove.cookies(),r.append.cookies([...x,y()]);const p=Object.entries(w).map(([f,v])=>({...y(),key:f,value:v}));r.remove.headers(),r.append.headers([...p,y()]),n("body"),n("data"),n("bodyType"),i.body&&(t("bodyType","JSON"),t("json",W(i.body))),i.data&&(t("bodyType","x-www-form-urlencoded"),t("data",i.data.join("&")),a("bodyType"))}catch(i){console.error(i.message),t("path",o)}}}const ue=K(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1"}),"DeleteRounded"),Ve=({param:s,onChange:t,error:a,...r})=>{const[n,o]=b.useState(s),c=l=>{const{name:m,value:w}=l.target;o(x=>({...x,[m]:w}))},i=()=>{t(n)},h=()=>{t({})},d=l=>{const m={...n,active:l.target.checked};o(m),t(m)};return e.jsxs(Ce,{...r,children:[e.jsx(B,{children:e.jsx(H,{defaultValue:s.key,name:"key",onChange:c,onBlur:i,size:"small",placeholder:"key",fullWidth:!0,variant:"standard",slotProps:{input:{disableUnderline:!0}},error:a})}),e.jsx(B,{children:e.jsx(H,{defaultValue:s.value,name:"value",onChange:c,onBlur:i,size:"small",placeholder:"value",fullWidth:!0,variant:"standard",slotProps:{input:{disableUnderline:!0}},error:a})}),e.jsx(B,{align:"center",children:e.jsx(Ee,{disabled:!n.key||!n.value,checked:n.active,onChange:d})}),e.jsx(B,{align:"center",children:e.jsx(xe,{onClick:h,disabled:!n.key||!n.value,children:e.jsx(ue,{})})})]})},U=({paramsFields:s,onChange:t,errors:a})=>e.jsx(ke,{sx:{flexGrow:1,scrollbarWidth:"thin"},children:e.jsx(ge,{children:e.jsx(Te,{children:s.map((r,n)=>{var o;return e.jsx(Ve,{param:r,onChange:c=>t(c,n),error:!!((o=a.params)!=null&&o[n])},r.id)})})})}),Qe=b.forwardRef(({value:s,onChange:t,...a},r)=>e.jsxs(je,{ref:r,value:s,onChange:t,sx:{minWidth:100},variant:"standard",disableUnderline:!0,...a,children:[e.jsx(q,{value:"GET",children:"GET"}),e.jsx(q,{value:"POST",children:"POST"}),e.jsx(q,{value:"PATCH",children:"PATCH"}),e.jsx(q,{value:"DELETE",children:"DELETE"}),e.jsx(q,{value:"OPTIONS",children:"OPTIONS"})]})),Ze=({control:s,errors:t,onPaste:a})=>e.jsx(A,{name:"path",control:s,rules:{required:"Path is required"},render:({field:r})=>{var n;return e.jsx(H,{...r,label:"Request",fullWidth:!0,onPaste:a,sx:{height:"100%"},slotProps:{input:{startAdornment:e.jsx(Se,{position:"start",children:e.jsx(A,{name:"method",control:s,rules:{required:"Method is required"},render:({field:o})=>e.jsx(Qe,{...o})})}),placeholder:"your/request/path"}},error:!!t.path,helperText:(n=t.path)==null?void 0:n.message})}}),et=({control:s,bodyTypeWatch:t,validateBody:a,errors:r,onJsonBlur:n})=>e.jsxs(e.Fragment,{children:[e.jsx(A,{name:"bodyType",control:s,rules:{required:"Body type is required"},render:({field:o})=>e.jsxs(qe,{row:!0,...o,children:[e.jsx(se,{value:"JSON",control:e.jsx(ae,{}),label:"JSON"}),e.jsx(se,{value:"x-www-form-urlencoded",control:e.jsx(ae,{}),label:"x-www-form-urlencoded"})]})}),e.jsxs(I,{paddingBlock:2,children:[t==="JSON"&&e.jsx(A,{name:"json",control:s,rules:{validate:a},render:({field:o})=>{var c;return e.jsx(H,{...o,fullWidth:!0,label:"Valid json",multiline:!0,rows:8,error:!!r.json,helperText:(c=r.json)==null?void 0:c.message,onBlur:n})}}),t==="x-www-form-urlencoded"&&e.jsx(A,{name:"data",control:s,render:({field:o})=>{var c;return e.jsx(H,{...o,fullWidth:!0,label:"Data",multiline:!0,rows:8,error:!!r.data,helperText:(c=r.data)==null?void 0:c.message})}})]})]}),tt=({title:s,onChange:t})=>{const[a,r]=b.useState(!1),[n,o]=b.useState(s),c=()=>{r(!1);const d=n.trim();if(!d){i();return}o(d),t(d)},i=()=>{r(!1),o(s),t(s)},h=d=>{d.key==="Enter"&&c(),d.key==="Escape"&&i()};return b.useEffect(()=>{o(s)},[s]),a?e.jsx(H,{value:n,onChange:d=>o(d.target.value),onBlur:c,onKeyDown:h,autoFocus:!0,fullWidth:!0,size:"small",variant:"standard",slotProps:{input:{disableUnderline:!0}},sx:{"& .MuiInputBase-input":{fontSize:"1.44rem",fontWeight:400,padding:0}}}):e.jsx(I,{sx:{width:"100%",cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden"},children:e.jsx(P,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flexGrow:1},variant:"H5",onClick:()=>r(!0),children:s})})},ne=()=>({method:"GET",path:"",json:"{}",data:"",params:[y()],headers:[y()],cookies:[y()],bodyType:"JSON",title:"New request",id:oe()}),st=({...s})=>{const t=T.use.request(),{enqueueSnackbar:a}=fe(),{handleSubmit:r,control:n,formState:{errors:o,isValid:c,isDirty:i},setValue:h,trigger:d,reset:l,resetField:m,watch:w,fieldArrays:x,fieldsController:p,handleArrayFieldsChange:f}=Ye(ne());b.useEffect(()=>{const u=["params","headers","cookies"];return t?(l({...t,json:W(t.json),params:[...z(t.params)],headers:[...z(t.headers||[])],cookies:[...z(t.cookies||[])]}),u.forEach(j=>{p.append[j](y())})):(l(ne()),u.forEach(j=>{p.replace[j]([y()])})),()=>l()},[t,l,p]);const{onSubmit:v,isLoading:R}=Xe(),[k,M]=b.useState(0),E=(u,j)=>{M(j)},O=w("bodyType"),S=b.useCallback(u=>{if(O==="JSON"&&u.trim())try{return JSON.parse(u),!0}catch{return"Invalid JSON format"}return!0},[O]),D=async u=>{const j=u.target.value;try{const ee=JSON.parse(j.trim()),pe=W(ee);h("json",pe),await d("json")}catch{h("json",j.trim()),await d("json")}},V=u=>{_e({e:u,setValue:h,trigger:d,fieldsController:p,resetField:m})},F=()=>{try{navigator.clipboard.writeText(We(t)),a("Copied to clipboard",{variant:"info"})}catch(u){t?a(`Did not copied to clipboard: ${u.message}`,{variant:"error"}):a("There is nothing to copy. Try to save or update the request.",{variant:"warning"})}Z()},[g,Q]=b.useState(null),he=u=>{u.preventDefault(),Q(g===null?{mouseX:u.clientX+2,mouseY:u.clientY-6}:null)},Z=()=>{Q(null)};return e.jsxs(e.Fragment,{children:[e.jsxs(C,{...s,gap:2,component:"form",onSubmit:r(v),justifyContent:"space-between",children:[e.jsxs(C,{gap:2,flexGrow:1,children:[e.jsx(A,{name:"title",control:n,render:({field:u})=>e.jsx(tt,{title:u.value,onChange:u.onChange})}),e.jsx(C,{direction:"row",gap:2,paddingTop:2,onContextMenu:he,children:e.jsx(Ze,{control:n,errors:o,onPaste:V})}),e.jsxs(Pe,{value:k,onChange:E,children:[e.jsx(J,{label:"Query"}),e.jsx(J,{label:"Body"}),e.jsx(J,{label:"Headers"}),e.jsx(J,{label:"Cookies"})]}),e.jsx(I,{flexGrow:1,position:"relative",children:e.jsxs(I,{position:"absolute",height:"100%",width:"100%",overflow:"auto",children:[k===0&&e.jsx(U,{onChange:(u,j)=>f(j,u,"params"),paramsFields:x.params,errors:o}),k===1&&e.jsx(et,{onJsonBlur:D,control:n,bodyTypeWatch:O,validateBody:S,errors:o}),k===2&&e.jsx(U,{onChange:(u,j)=>f(j,u,"headers"),paramsFields:x.headers,errors:o}),k===3&&e.jsx(U,{onChange:(u,j)=>f(j,u,"cookies"),paramsFields:x.cookies,errors:o})]})})]}),e.jsx(I,{textAlign:"end",children:e.jsx(ye,{type:"submit",variant:"contained",sx:{minWidth:"100px"},disabled:!c||!i,loading:R,children:t?"Update":"Save"})})]}),e.jsx(re,{open:g!==null,onClose:Z,anchorReference:"anchorPosition",anchorPosition:g!==null?{top:g.mouseY,left:g.mouseX}:void 0,children:e.jsxs(q,{onClick:F,children:[e.jsx(ie,{children:e.jsx(Me,{fontSize:"small"})}),e.jsx(ce,{children:"copy as curl(Bash)"})]})})]})},at=K(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m4 11h-3v3c0 .55-.45 1-1 1s-1-.45-1-1v-3H8c-.55 0-1-.45-1-1s.45-1 1-1h3V8c0-.55.45-1 1-1s1 .45 1 1v3h3c.55 0 1 .45 1 1s-.45 1-1 1"}),"AddCircleRounded"),nt=()=>{const s=T.use.unsetRequest(),t=T.use.request();return e.jsx(de,{disablePadding:!0,children:e.jsx(le,{disabled:!t,onClick:()=>{s()},children:e.jsx(C,{width:"100%",gap:1,direction:"row",alignItems:"center",justifyContent:"center",children:e.jsx(at,{})})})})},rt=({request:s})=>{const t=T.use.setRequest(),a=T.use.request(),r=T.use.unsetRequest(),n=De(),[o,c]=b.useState(null),i=l=>{l.preventDefault(),c(o===null?{mouseX:l.clientX+2,mouseY:l.clientY-6}:null)},h=()=>{c(null)},d=()=>{n.mutate(s.id),(a==null?void 0:a.id)===s.id&&r(),h()};return e.jsxs(e.Fragment,{children:[e.jsx(de,{disablePadding:!0,onContextMenu:i,children:e.jsx(be,{title:s.path,disableInteractive:!0,children:e.jsx(le,{selected:s.id===(a==null?void 0:a.id),onClick:()=>{t(s)},children:e.jsxs(C,{gap:1,direction:"row",alignItems:"center",sx:{width:"100%",whiteSpace:"nowrap",overflow:"hidden"},children:[e.jsx(P,{variant:"caption",color:"textSecondary",minWidth:"50px",children:s.method}),e.jsx(P,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flexGrow:1},children:s.title})]})})})}),e.jsx(re,{open:o!==null,onClose:h,anchorReference:"anchorPosition",anchorPosition:o!==null?{top:o.mouseY,left:o.mouseX}:void 0,children:e.jsxs(q,{onClick:d,children:[e.jsx(ie,{children:e.jsx(ue,{fontSize:"small"})}),e.jsx(ce,{children:"Delete"})]})})]})},ot=({...s})=>{const{data:t,isError:a,isLoading:r}=Re();if(r)return e.jsx(C,{gap:2,justifyContent:"center",alignItems:"center",sx:{height:"100%"},...s,children:e.jsx(ve,{})});if(a)return e.jsx(C,{gap:2,justifyContent:"center",alignItems:"center",sx:{height:"100%"},...s,children:e.jsx(P,{variant:"H5",color:"error",children:"Error"})});const n=({index:o,style:c})=>{const i=t[o];return e.jsx("div",{style:c,children:e.jsx(rt,{request:i})})};return e.jsxs(C,{gap:2,...s,height:"100%",children:[e.jsx(P,{variant:"H5",children:"Your requests"}),!t.length&&e.jsx(P,{variant:"Body",color:"textSecondary",children:"Empty for now"}),t.length?e.jsx(nt,{}):null,e.jsx(I,{flexGrow:1,position:"relative",children:e.jsx(we,{sx:{position:"absolute",width:"100%",height:"100%",overflow:"auto"},children:e.jsx(Oe,{children:({height:o,width:c})=>e.jsx(Ae,{height:o,width:c,itemCount:t.length,itemSize:40,overscanCount:1,children:n})})})})]})},ut=()=>e.jsxs(C,{gap:4,flexGrow:1,maxWidth:"100%",children:[e.jsx(P,{variant:"H3",children:"Requests"}),e.jsxs(G,{container:!0,spacing:2,sx:{flexGrow:1},children:[e.jsx(G,{size:3,children:e.jsx(te,{sx:{height:"100%",padding:2},children:e.jsx(ot,{})})}),e.jsx(G,{size:"grow",children:e.jsx(te,{sx:{height:"100%"},children:e.jsx(C,{sx:{height:"100%"},gap:2,padding:2,children:e.jsx(st,{flexGrow:1})})})})]})]});export{ut as default};
